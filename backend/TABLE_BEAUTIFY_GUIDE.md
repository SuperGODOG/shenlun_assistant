# 表格美化功能使用指南

## 功能概述

本系统提供了强大的表格美化功能，可以将LLM输出的混乱表格文本自动转换为格式整齐、美观的表格。支持多种输入格式和输出样式。

## 主要特性

- ✅ **自动检测表格**：智能识别文本中的表格内容
- ✅ **多种分隔符支持**：支持管道符(|)、制表符(\t)、中文逗号(，)、顿号(、)等
- ✅ **中文字符优化**：正确处理中文字符宽度，确保对齐美观
- ✅ **两种输出格式**：支持Markdown格式和纯文本格式
- ✅ **混合内容处理**：可以处理包含表格的混合文本内容
- ✅ **边界情况处理**：智能处理单行、空内容等边界情况

## API接口

### 1. 表格美化接口

**接口地址：** `POST /api/beautify-table`

**请求参数：**
```json
{
  "text": "题型|评分标准|分值\n归纳概括|准确性、完整性|15分\n提出对策|针对性、可行性|20分",
  "format": "text",        // 可选："text" 或 "markdown"，默认为 "text"
  "auto_detect": true      // 可选：是否自动检测表格，默认为 true
}
```

**响应示例：**
```json
{
  "original_text": "原始文本...",
  "beautified_text": "美化后的表格...",
  "format": "text",
  "auto_detect": true,
  "content_type": "text/plain"
}
```

### 2. 聊天接口（已集成表格美化）

**接口地址：** `POST /api/chat`

现在聊天接口已经自动集成了表格美化功能，LLM的回复中如果包含表格，会自动进行美化处理。

## 使用示例

### 示例1：基本表格美化

**输入：**
```
题型|评分标准|分值|要点
归纳概括|准确性、完整性|15分|要点齐全
提出对策|针对性、可行性|20分|措施具体
综合分析|逻辑性、深度|25分|分析透彻
```

**输出（纯文本格式）：**
```
┌──────────┬──────────────────┬──────┬──────────┐
│ 【题型】   │ 【评分标准】       │ 【分值】 │ 【要点】   │
├──────────┼──────────────────┼──────┼──────────┤
│ 归纳概括 │ 准确性、完整性   │ 15分 │ 要点齐全 │
│ 提出对策 │ 针对性、可行性   │ 20分 │ 措施具体 │
│ 综合分析 │ 逻辑性、深度     │ 25分 │ 分析透彻 │
└──────────┴──────────────────┴──────┴──────────┘
```

### 示例2：中文逗号分隔的表格

**输入：**
```
申论题型，字数要求，时间分配，答题要点
归纳概括题，150-200字，25分钟，要点全面准确
综合分析题，300-400字，35分钟，逻辑清晰深入
提出对策题，300-500字，40分钟，措施具体可行
```

**输出：**
```
┌──────────────┬──────────────┬──────────┬──────────────────┐
│ 【申论题型】   │ 【字数要求】   │ 【时间分配】 │ 【答题要点】       │
├──────────────┼──────────────┼──────────┼──────────────────┤
│ 归纳概括题   │ 150-200字    │ 25分钟   │ 要点全面准确     │
│ 综合分析题   │ 300-400字    │ 35分钟   │ 逻辑清晰深入     │
│ 提出对策题   │ 300-500字    │ 40分钟   │ 措施具体可行     │
└──────────────┴──────────────┴──────────┴──────────────────┘
```

### 示例3：混合内容自动检测

**输入：**
```
申论考试评分标准说明

以下是各题型的详细评分标准：

题型|分值|评分要点
归纳概括|15分|要点齐全、表述准确
提出对策|20分|针对性强、可操作
综合分析|25分|逻辑清晰、分析深入

上述标准适用于所有申论考试。
```

**输出：**
```
申论考试评分标准说明

以下是各题型的详细评分标准：

┌──────────┬──────┬────────────────────┐
│ 【题型】   │ 【分值】 │ 【评分要点】         │
├──────────┼──────┼────────────────────┤
│ 归纳概括 │ 15分 │ 要点齐全、表述准确 │
│ 提出对策 │ 20分 │ 针对性强、可操作   │
│ 综合分析 │ 25分 │ 逻辑清晰、分析深入 │
└──────────┴──────┴────────────────────┘

上述标准适用于所有申论考试。
```

## 支持的分隔符

1. **管道符 (|)**：`题型|分值|要点`
2. **制表符 (\t)**：`题型    分值    要点`
3. **双空格 (  )**：`题型  分值  要点`
4. **中文逗号 (，)**：`题型，分值，要点`
5. **顿号 (、)**：`题型、分值、要点`

## 输出格式对比

### Markdown格式
- 使用标准的Markdown表格语法
- 适合在支持Markdown的环境中显示
- 使用 `-` 和 `+` 字符构建表格边框

### 纯文本格式
- 使用Unicode字符绘制表格边框
- 在任何文本环境中都能正确显示
- 表头使用【】符号突出显示
- 使用 `┌┬┐├┼┤└┴┘│─` 等字符构建精美边框

## 注意事项

1. **最少行数**：表格至少需要2行（表头+数据行）才会被识别
2. **最少列数**：表格至少需要2列才会被处理
3. **中文字符**：系统会自动计算中文字符的显示宽度，确保对齐
4. **空单元格**：如果某行的列数不足，会自动补充空单元格
5. **边界情况**：单行内容、空内容等不会被当作表格处理

## 集成到现有系统

表格美化功能已经集成到聊天API中，当LLM返回包含表格的内容时，会自动进行美化处理。用户无需额外操作，即可获得格式整齐的表格输出。

如需单独使用表格美化功能，可以直接调用 `/api/beautify-table` 接口。

## 技术实现

- **智能分隔符检测**：自动识别最适合的分隔符
- **中文字符宽度计算**：正确处理中文字符占用2个显示位置的特性
- **动态列宽调整**：根据内容自动调整每列的宽度
- **Unicode表格字符**：使用标准Unicode字符绘制美观的表格边框

---

通过这个表格美化功能，用户可以轻松将LLM输出的混乱表格转换为专业、美观的格式，大大提升了内容的可读性和专业性。